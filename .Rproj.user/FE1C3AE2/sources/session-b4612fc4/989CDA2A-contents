---
title: "Untitled"
author: "Josué David Mendoza Hewitt"
date: "2024-09-12"
output: html_document
---

```{r}
library(psych)
library(readxl)
library(ellipse)
library(corrplot)
library(Hmisc)
library(ggplot2)
library(ggplot2)
library(readxl)
library(corrplot)
library(knitr)
library(gridExtra)
library(ggplot2)
library(gridExtra)
library(grid)
library(patchwork)
library(kableExtra)

datos_env <- read.delim("https://raw.githubusercontent.com/JosmenX10/Informe-final-de-multivariada/main/Base%20de%20datos%20y%20contextos/vltava_env.csv", sep = ",")
 #Llamamos a la base de datos.

datos_env <- read.delim("https://raw.githubusercontent.com/JosmenX10/Informe-final-de-multivariada/main/Base%20de%20datos%20y%20contextos/vltava_env.csv", sep = ",")

#Seleccionamos entre grupos de variables
topo <- datos_env[,4:17]#Seleccionamos solamente las variables topograficas y de suelo.

ellin <- datos_env[,19:24]#seleccionamos solo las variables indices-ellinger.
#-----------------------------------------------------------------------

#Generamos las matrices de correlación para analisis 
topocor <- cor(topo, method = "spearman") #correlación entre topograficas.

pval_topo <- corr.test(topo, adjust="none",method = "spearman")$p #p-value de correlaciones entre topograficas.


ellin_topocor <- cor(y = topo, x = ellin, method = "spearman") #correlación entre topograficas.

pval_ellin<- corr.test(y= topo, x= ellin, adjust="none",method = "spearman")$p #p-value de correlaciones entre topograficas.


```

# Evaluación de la relación entre variables topograficas y topologica

A partir de correlogramas podemos tener una vista general de la relaciones entre las variables, visualizando el grado de correlación y el nivel de significancia de estas relaciones. Por ejemplo, la @fig-fig1 refleja la estrecha relación positiva entre las variables de orientación sureste y la orientación sur-sureste al tener un 83% de correlación entre sus datos con el mayor nivel de significancia(p-value\<0.001), así mismo pasaría con los indices de carga calorifica que se derivan de estos, los cuales tienen una correlación positiva entre si, en la que las variaciones de uno se explicarian por las variaciones del otro en el 79% de los datos. Esto se entiende ya que el cambio en la orientación sureste entre las parcelas también deberia ser acompoñado por cambios en la orientación sur-sureste, Con una alta significancia (P.value\< 0.001) el tipo de relieve a favor de la pendiente tiende a ser más convexo a medida que aumenta la altitud, esto se evidencia en el 62% de los datos de acuerdo al indice de Spearman. Entre los tipos de suelo, el fluvisol tiene una correlación considerablemente negativa y con un alto nivel de significancia con la altitud y las superficies concavas en dirección a la pendiente(-0.62 y -0.67), . A continuación se realizará una exploración visual de las relaciones con el mayor nivel de significancia y con un grado de correlación mayor al 60%.

```{r, warning=FALSE,message=FALSE}

#| label: fig-fig1 
#| fig-cap: "Correlograma de las relaciones de las variables topologicas y topograficas usando el indice de correlación de Spearman: Los elipses azules inclinadas a la derecha representan las relaciones lineales positivas, mientras que las elipses rojas inclinadas a la izquierda representan las relaciones lineales negativas. El nivel de significancia se representa por medio de asteriscos(* = 0.05, ** = 0.01, 0.001 = ***)."


  
corrplot(topocor,method = "ellipse",type ="lower",diag = FALSE,
         tl.pos = "ld",order ="original",tl.col = "black",addCoef.col= NULL, cl.pos = T, sig.level = c(0.001,0.01,0.05),
         p.mat = pval_topo,insig = c("label_sig"), pch= "*",pch.cex = 0.5, pch.col ="black",
         tl.cex = 1.0, number.cex = 0.9, cl.cex = 0.8,tl.srt = 50,addgrid.col = "#f5f5f5")
         
```

```{r}
#| label: fig-fig2 
#| fig-cap: "Diagrama de dispersión de las variables de orientación y capacidad calorífica. A) Relación entre orientación Sur con la orientación Sur-Sureste. B)Relación entre el indice de capacidad calorífica."



g1 = ggplot(datos_env, aes(x = Orientación.SE , y = Orientación.S.SE)) + 
  geom_smooth(aes(x = Orientación.SE, y = Orientación.S.SE), se = F, span = 1, col = "black") +
  geom_point(col = "orange") + labs(x = "Orientación Sureste",y= "Orientación S-SE" , tag = "A)") + 
  theme_classic() 


g2 = ggplot(datos_env, aes(x = CCSE , y = CCS.SE)) + 
  geom_smooth(aes(x = CCSE, y = CCS.SE), se = F, span = 1, col = "black") +
  geom_point(col = "orange") + labs(x = "Indice de CC sureste", y = "Indice de CC S-SE", tag = "B)") +
  theme_classic()


g1/g2


```

```{r}
#| label: fig-fig3 
#| fig-cap: "Diagrama de cajas y bigotes para comparar las altitudes entre distintos tipos de superficie en las parcelas según el eje a favor de la pendiente."

g3 = ggplot(datos_env,aes(x=factor(Superficie.PD),y=Elevación)) + 
  geom_boxplot(aes(y= Elevación, fill = factor(Superficie.PD)), notch = TRUE) + theme_classic() + 
  guides(fill = "none") +   scale_x_discrete(labels = c("1" = "Convexo", "0" = "Neutro", "-1" = "Concavo")) + 
  labs( x = "Tipos de relieve a lo largo de la pendiente")

g3


```

```{r}
#| label: fig-fig4 
#| fig-cap: "Diagrama de cajas y bigotes para comparar las altitudes para las parcelas en distintos tipos de superficie según el eje a favor de la pendiente."

g4 = ggplot(datos_env,aes(x=factor(Lítico),y=Elevación)) + 
  geom_boxplot(aes(y= Elevación, fill = factor(Lítico)), notch = TRUE) + theme_classic() + 
  guides(fill = "none") +   scale_x_discrete(labels = c("1" = "Lítico", "0" = "No Litico")) + labs(x = "Condición del lítica del suelo")

g4


```

```{r}
#| label: fig-fig5 
#| fig-cap: "Diagrama de cajas y bigotes para comparar las altitudes para las parcelas en distintos tipos de superficie según el eje a favor de la pendiente."

Sup.pd <- factor(datos_env$Superficie.PD, levels = c(1, 0, -1), labels = c("Convexo", "Neutro", "Cóncavo"))

Pendiente.pd <- factor(datos_env$Lítico, levels = c(1, 0), labels = c("Lítico", "No Lítico"))

factores <- paste(Sup.pd,Pendiente.pd, sep ="-")

datos_env$factores <- factores

je <- c("Cóncavo-No Lítico",  "Neutro-No Lítico", "Convexo-No Lítico","Cóncavo-Lítico", "Neutro-Lítico","Convexo-Lítico")


 ggplot(datos_env,aes(x=factor(factores, levels = je) ,y=Elevación)) + 
  geom_boxplot(aes(y= Elevación, fill =factor(factores, levels = je))) + theme_classic() + 
  guides(fill = "none") + labs( x = "Tipos de relieve a lo largo de la pendiente")


```

# **Evaluación de la relación de las variables topograficas y topologicas con los indices de Hellinberg**

```{r, message=FALSE,warning=FALSE}
#| label: fig-fig6 
#| fig-cap: "Correlograma de las relaciones de las variables topologicas y topograficas con los indices de Hellinberg usando el indice de correlación de Spearman: Los elipses azules inclinadas a la derecha representan las relaciones lineales positivas, mientras que las elipses rojas inclinadas a la izquierda representan las relaciones lineales negativas. El nivel de significancia se representa por medio de asteriscos(* = 0.05, ** = 0.01, 0.001 = ***)."
#| 
corrplot(ellin_topocor,method = "ellipse",
         tl.pos = "dt",tl.col = "black",sig.level = c(0.001,0.01,0.05),
         p.mat = pval_ellin, insig = c("label_sig"), pch= "*",pch.cex = 1.0, pch.col ="black"
         ,tl.cex = 1.0, number.cex = 0.9,addgrid.col = "#f5f5f5")

```

```{r}
#| label: fig-fig7 
#| fig-cap: "Diagrama de dispersión de las variables topograficas y topolagicas contra los indices de Hellinberg.A) Relación entre continentalidad, temperatura y luz con la orientación sur-sureste. B) Relación entre humedad, reactividad y nutrientes con la orientación sur-sureste, C)Relación entre continentalidad, temperatura y luz con la capacidad calorifica sur-sureste. D)Relación entre humedad, reactividad y nutrientes con la capacidad calorifica sur-sureste, E)Relación entre humedad, reactividad y nutrientes con el pH diluido de las muestras de suelo.F)Relación entre humedad, reactividad y nutrientes con la pendiente de la parcela."

include_graphics("C:\\Users\\Asus\\Desktop\\Analisis multivariado\\Informe-final-de-multivariada\\Graficos\\Excel\\Ellenberg vs ambientales.svg")
```

```{r, fig.width=2,fig.height=2}
#| label: fig-fig8 
#| fig-cap: "Diagrama de cajas y bigotes para comparar los indices de Hellinberg en distintas condiciones topograficas.A)Comparación del indice de humedad entre distintos tipos de superficie.B)Comparación del indice de nutrientes entre distintos tipos de superficie.C)Comparación del indice de humedad entre suelos líticos y no líticos."

include_graphics("C:\\Users\\Asus\\Desktop\\Analisis multivariado\\Informe-final-de-multivariada\\Graficos\\Excel\\Boxplot_ Ellenberg vs ambientales.svg")
```
