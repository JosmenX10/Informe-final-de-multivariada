---
title: "Influencia de la topológia y topográfia sobre la diversidad de plantas en los Valles profundos de Moldava"
date: last-modified
title-block-banner: "#99d8c9" 
author: "Josué Mendoza Hewitt, Santrich Jimenez, Juan Porto Herrera & Jhonatan Diaz Camargo"
format: 
  html:
    toc: true                 # Barra de menú
    toc-title: Menú flotante  # Nombre de la barra de menú flotante
    code-tools: false         # Códigos descargables (activar con true)
    code-fold: true
    css: "stile-justify.css"  # Justificación del texto
editor: visual
bibliography: biblio.bibtex    
lang: "ES-es"
csl: apa.csl
---

## Introducción

Las técnicas multivariadas han sido ampliamente utilizadas en la biología y ecología, permitiendo la caracterización o clasificación de las comunidades biológicas considerando la variación en la estructura comunitaria entre las unidades de muestreo, a la vez que se puede evaluar la influencia de gradientes ambientales sobre esta variación. Esto es posible gracias a que estos análisis permiten dilucidar patrones que brindan información sobre la relación de múltiples elementos inherentes a estos sistemas naturales, facilitando la interpretación de generalidades y especificidades de estas relaciones [@Borcard2011NumericalEW; @book ; @Javier]. Además, la aplicación de estas técnicas multivariadas por medio de algoritmos computacionales han facilitado que estos se vuelvan cada vez más sofisticados en sus calculos, permitiendo que existan métodos cada vez más eficaces según las bases de datos y objetivos de estudio [@AYOUBHANNAA201348; @LI2022104806].

Por esta razón, para el presente trabajo de caso se dispone de una base de datos de acceso público para la aplicación de estas técnicas multivariadas, la cual consiste en un estudio de la vegetación en valles profundos del río de Moldava en República Checa, donde se tomaron valores de cobertura de cada especie de planta en las unidades de muestreo o parcelas, a la vez que se midieron variables topográficas, topológicas y medidas indirectas de los niveles de nutrientes, continentalidad, humedad, temperatura y reactividad en las parcelas [@ellenberg1974; @ellenberg1979]. Este estudio se realizó con el objetivo de probar las predicciones del “fenómeno fluvial” por métodos cuantitativos, el cual mencionaba una serie de observaciones sobre los patrones de vegetación en estos ecosistemas [@blazkova1964; @turk1994], entre ellos, se destaca la observación de que la distribución y riqueza de la vegetación no es aleatoria. Al ser los patrones de vegetación dependientes del ambiente es posible que estas puedan presentar una influencia similar entre dos o más ecosistemas independientes, tal cual como @article encontró en los valles del Río de Moldava y el Río de Dyje.

Las técnicas multivariadas aplicadas en este caso permitieron revelar información importante para el entendimiento de la interacción ambiente-vegetación en el macizo de bohemia, por lo que es un indispensable entender los fundamentos de estos métodos de manera practica y teórica, para comprender su plausibilidad ante otros casos de estudio. Sin embargo, más allá de replicar objetivos de análisis de @article, se pretende analizar la influencia en otros aspectos de la diversidad a parte de la composición, como podría ser la riqueza, uniformidad y dominancia, aplicando el método de números efectivos de Hill propuesto por @chao2014.

## **Pregunta de análisis**

¿Qué influencia tiene la topología y topografia en la estructura de las comunidades de plantas en los valles profundos del río de Moldava?

## **Objetivo general**

-Evaluar la influencia de los parámetros ambientales en múltiples aspectos de la estructura de las comunidades de plantas en el valle profundo del río de Moldava.

## **Objetivos específicos**

-Caracterizar los distintos tipos de comunidades de plantas en el valle profundo de Moldava.

\- Determinar la diversidad para cada uno de los tipos de comunidades en función de especies totales, comunes y dominantes en el valle profundo de Moldava.

-Evaluar el grado de explicación que tendrían las variables ambientales sobre la variación en la composición de los tipos de comunidades en el valle profundo de Moldava.

## Diseño experimental del análisis Multivariado

![](Base%20de%20datos%20y%20contextos/diagrama_de_flujo.svg)

## Organización de la base de datos

### Cargue de librerias y bases de datos

```{r, warning=FALSE,message=FALSE}
library(psych)
library(readxl)
library(ellipse)
library(corrplot)
library(Hmisc)
library(ggplot2)
library(ggplot2)
library(readxl)
library(corrplot)
library(knitr)
library(gridExtra)
library(ggplot2)
library(gridExtra)
library(grid)
library(patchwork)
library(kableExtra)

datos_env <- read_xlsx("C:\\Users\\Asus\\Desktop\\Analisis multivariado\\Informe-final-de-multivariada\\Base de datos y contextos\\vltava.xlsx",
                       sheet = "Vltava-env data")

datos <- read_xlsx("C:\\Users\\Asus\\Desktop\\Analisis multivariado\\Informe-final-de-multivariada\\Base de datos y contextos\\vltava.xlsx",
                   sheet = "Vltava-species")


```

### Organización de las bases de datos

En la matriz de datos biologicos, las variables que son las especies se presentan como filas, mientras que las unidades de muestreo que son las parcelas estarían en columnas por lo que se debe realizar una transposición de la matriz original.

```{r, warning=FALSE,message=FALSE}
#Se transpone la base de datos dejando las parcelas como filas
datos_bio <- datos[,-1]

datos_bio <- t(datos_bio)

colnames(datos_bio) <- datos$...1

write.csv(datos_bio,file = "datos_bio.csv")

str(datos_bio)

```

En la matriz de datos ambientales simplemente se debe organizar las variables y generar un cambio de los nombres para ciertos productos visuales.

```{r}
# Preparamos la base de datos ambientales 
colnames(datos_env) = c("Parcela","Transecto","Elevación","Pendiente","Orientación.SE",
                        "Orientación.S.SE", "CCSE","CCS.SE","Superficie.PD","Superficie.ISO",
                        "Lítico","Esqueletico","Cambisoles","Fluvisoles","P.del suelo","pH",
                        "Cobertura veg.","Luz","Temperatura","Continentalidad","Humedad",
                        "Reactividad","Nutrientes","Riqueza sp","Grupos")


datos1 <- datos_env[,c("Parcela","Transecto","Elevación","Pendiente","Orientación.SE",
                       "Orientación.S.SE", "CCSE","CCS.SE","Superficie.PD","Superficie.ISO","P.del suelo","pH")]

datos2 <- datos_env[,c("Lítico","Esqueletico","Cambisoles","Fluvisoles", "Cobertura veg.","Luz","Temperatura","Continentalidad","Humedad",
                       "Reactividad","Nutrientes","Riqueza sp","Grupos")]


datos_env <- cbind(datos1,datos2)

write.csv(datos_env,"vltava_env.csv")

row.names(datos_env) <- datos_env$Parcela

datos_env <- datos_env[,-1]

str(datos_env)
```

## **Análisis exploratorios**

### **Evaluación de la relación entre variables topográficas y topológicas**

A partir de correlogramas se puede tener una vista general de la relaciones entre las variables, visualizando el grado de correlación y el nivel de significancia de estas relaciones. Por ejemplo, la @fig-fig1 refleja la estrecha relación positiva entre las variables de orientación sureste y la orientación sur-sureste al tener un 83% de correlación entre sus datos con el mayor nivel de significancia(p-value\<0.001), así mismo pasaría con los indices de capacidad calorifica que se derivan de estos, los cuales tienen una correlación positiva entre si, en la que las variaciones de uno se explicarian por las variaciones del otro en el 79% de los datos, esto se entiende ya que el cambio en la orientación sureste entre las parcelas también deberia ser acompoñada por cambios en la orientación sur-sureste. El tipo de relieve a favor de la pendiente tiende a ser más convexa a medida que aumenta la altitud, esto se evidencia por un grado de correlación del 62% . Entre los tipos de suelo, el fluvisol tiene una correlación considerablemente negativa con la altitud y las superficies en dirección a la pendiente (-0.62 y -0.67), teniendo el mayor nivel de significancia. A continuación se realizará una exploración visual de las relaciones con el mayor nivel de significancia y con un grado de correlación mayor al 60%.

```{r, warning=FALSE,message=FALSE}
#| label: fig-fig1 
#| fig-cap: "Correlograma de las relaciones de las variables topológicas y topográficas usando el indice de correlación de Spearman: Los elipses azules inclinadas a la derecha representan las relaciones lineales positivas, mientras que las elipses rojas inclinadas a la izquierda representan las relaciones lineales negativas. El nivel de significancia se representa por medio de asteriscos (* = 0.05, ** = 0.01, 0.001 = ***)."


#Seleccionamos entre grupos de variables
topo <- datos_env[,3:16]#Seleccionamos solamente las variables topográficas y de suelo.

ellin <- datos_env[,18:23]#seleccionamos solo las variables indices-ellinger.
#-----------------------------------------------------------------------

#Generamos las matrices de correlación para analisis 
topocor <- cor(topo, method = "spearman") #correlación entre topográficas.

pval_topo <- corr.test(topo, adjust="none",method = "spearman")$p #p-value de correlaciones entre topográficas.


ellin_topocor <- cor(y = topo, x = ellin, method = "spearman") #correlación entre topográficas.

pval_ellin<- corr.test(y= topo, x= ellin, adjust="none",method = "spearman")$p #p-value de correlaciones entre topográficas.

corrplot(topocor,method = "ellipse",type ="lower",diag = FALSE,
         tl.pos = "ld",order ="original",tl.col = "black",addCoef.col= NULL, cl.pos = T, sig.level = c(0.001,0.01,0.05),
         p.mat = pval_topo,insig = c("label_sig"), pch= "*",pch.cex = 0.5, pch.col ="black",
         tl.cex = 1.0, number.cex = 0.9, cl.cex = 0.8,tl.srt = 50,addgrid.col = "#f5f5f5")
        
```

En la @fig-fig2 (A) se confirma la relación lineal postiva entre la orientación sureste y la orientación sur-sureste, tener estas dos variables en cuenta para los analisis podría generar ruido y disminuir la posibilidad de una correcta interpretación. Cabe resaltar que al medir los valores de orientación medido en una magnitud escalar, aumentando el valor de manera positiva a medida que la orientación de las parcelas se acercan a la orientación sureste puede generar que dos parcelas con dos direcciones diferentes tengan el mismo valor al situarse a la misma cantidad de grados desviados del noroeste, pero en la orientación sur-sureste estas tendran valores diferentes @fig-fig3, razon por la que en el grafico se observa que cada valor en el eje x tendría dos valores en eje y, generando dos lineas de puntos en las partes de arriba y abajo de la linea de tendencia. La @fig-fig2 (B) evidencia una estrecha relación entre las vairables de carga calorifica en valores cercanos a 0, pero a medida que aumenta la carga calorifica del sureste parece haber valores más desviados de la linea suavizada de tendencia. Los datos que muestran cierta diferencia a los patrones generales podrían ser debido a mediciones erradas de las orientaciones o situaciones particulares de ciertas parcelas.

```{r, message=FALSE,warning=FALSE}
#| label: fig-fig2 
#| fig-cap: Diagrama de dispersión de las variables de orientación y capacidad calorífica. A) Relación entre orientación Sur con la orientación Sur-Sureste. B)Relación entre el indice de capacidad calorífica.



g1 = ggplot(datos_env, aes(x = Orientación.SE , y = Orientación.S.SE)) + 
  geom_smooth(aes(x = Orientación.SE, y = Orientación.S.SE), se = F, span = 1, col = "black") +
  geom_point(col = "orange") + labs(x = "Orientación Sureste",y= "Orientación S-SE" , tag = "A)") + 
  theme_classic() 


g2 = ggplot(datos_env, aes(x = CCSE , y = CCS.SE)) + 
  geom_smooth(aes(x = CCSE, y = CCS.SE), se = F, span = 1, col = "black") +
  geom_point(col = "orange") + labs(x = "Indice de CC sureste", y = "Indice de CC S-SE", tag = "B)") +
  theme_classic()


g1/g2


```

```{r, fig.width=0.5,fig.height=0.8}
#| label: fig-fig3 
#| fig-cap: "Diagrama explicativo de las mediciones de orientación."


include_graphics("C:\\Users\\Asus\\Desktop\\Analisis multivariado\\Informe-final-de-multivariada\\Graficos\\Explicaciones\\Orientación.svg")
```

A partir de la @fig-fig4 se evidencia un claro patron de los tipos de superficies o relieves a favor de la pendiente, a medida que cambia la altitud, pues se observan más parcelas con relieve concavo en altitudes bajas que en altitudes altas, así mismo los relieves neutros son más comunes en altitudes intermedias y los relieves convexos más comunes en altitudes mayores, aunque el leve solapamiento de las muescas dan la posibilidad de que no hubiera diferencias significativas en la altitud de los relieves neutros y convexos.

```{r,warning=FALSE,message=FALSE}
#| label: fig-fig4 
#| fig-cap: "Diagrama de cajas y bigotes para comparar las altitudes entre distintos tipos de superficie en las parcelas según el eje a favor de la pendiente."

g3 = ggplot(datos_env,aes(x=factor(Superficie.PD),y=Elevación)) + 
  geom_boxplot(aes(y= Elevación, fill = factor(Superficie.PD)), notch = TRUE) + theme_classic() + 
  guides(fill = "none") +   scale_x_discrete(labels = c("1" = "Convexo", "0" = "Neutro", "-1" = "Concavo")) + 
  labs( x = "Tipos de relieve a lo largo de la pendiente")

g3


```

También es posible observar cierto grado de diferencia en el tipo de suelo lítico y no lítico en diferentes altitudes, aunque podría no haber diferencias significativas en la @fig-fig5 se puede observar que en los diagramas de cajas bigotes la condición litica mantiene datos más concentrados a valores de mayor altitud que los no liticos.

```{r}
#| label: fig-fig5 
#| fig-cap: "Diagrama de cajas y bigotes para comparar las altitudes para las parcelas en suelos líticos y no líticos."

g4 = ggplot(datos_env,aes(x=factor(Lítico),y=Elevación)) + 
  geom_boxplot(aes(y= Elevación, fill = factor(Lítico)), notch = TRUE) + theme_classic() + 
  guides(fill = "none") +   scale_x_discrete(labels = c("1" = "Lítico", "0" = "No Litico")) + labs(x = "Condición del lítica del suelo")

g4

```

La condición de suelo Lítico también es dependiente del tipo de relieve, siendo que en las parcelas de relieve convexo son más frecuentes que los suelos no liticos, y en las parcelas con relieve neutro ya los suelos líticos son menos frecuente, y en los relieves concavos las parcelas con suelos no líticos son mucho más frecuentes que los líticos. Por lo tanto, los relieves convexos pueden favorecer el asentamiento de suelos líticos antes que de suelos no líticos, mientras que en los concavos pasa lo contrario.

```{r}
#| label: fig-fig6 
#| fig-cap: "histograma para comparar las frecuencias de las parcelas con distintos tipos de superficie según el eje a favor de la pendiente y si presenta o no el tipo de suelo lítico."

Sup.pd <- factor(datos_env$Superficie.PD, levels = c(1, 0, -1), labels = c("Convexo", "Neutro", "Cóncavo"))

Pendiente.pd <- factor(datos_env$Lítico, levels = c(1, 0), labels = c("Lítico", "No Lítico"))

factores <- paste(Sup.pd,Pendiente.pd, sep ="-")

je <- c("Cóncavo-No Lítico", "Cóncavo-Lítico","Neutro-No Lítico","Neutro-Lítico","Convexo-No Lítico" , "Convexo-Lítico")

datos_env$factores <- factor(factores, levels = je)

frecuencia_factores <- as.data.frame(table(datos_env$factores))

frecuencia <- frecuencia_factores$Freq

barplot(frecuencia, 
        main = "Comparación frecuencias de relieves y suelos líticos", 
        ylab = "Frecuencia", 
        col = rep(c("blue","orange"), times = 3), 
        border = "black", cex.names = 0.7,width = 2.5, names.arg = je, space = 1)
```

### **Evaluación de la relación de las variables topográficas y topológicas con variables ambientales(indices de Hellinberg)**

En el correlograma presentado en la @fig-fig7 observamos los grados de correlación entre las variables topográficas y topológicas con las variables ambientales medidas de manera indirecta con el promedio de indices de hellinberg en cada parcela, entonces habrían seis indices, una por cada variable y ambas se representan numericamente en las mismas escalas. De las seis variables cinco se relacionan de manera significativa con las variables de orientación y carga calorifica de las cuales la luz, la temperatura y la continentalidad se relacionan positivamente, mientras que la humedad y los nutrientes se relacionan negativamente, estas relaciones se ven más detalladas en los diagramas de dispersión de la @fig-fig8 (A-D). Por lo tanto la orientación y la capacidad calorifica de la parcela pueden ser determinantes para la variación en las condiciones de habitats entre las parcelas.

```{r, message=FALSE,warning=FALSE}
#| label: fig-fig7 
#| fig-cap: "Correlograma de las relaciones de las variables topológicas y topográficas con los indices de Hellinberg usando el indice de correlación de Spearman: Los elipses azules inclinadas a la derecha representan las relaciones lineales positivas, mientras que las elipses rojas inclinadas a la izquierda representan las relaciones lineales negativas. El nivel de significancia se representa por medio de asteriscos(* = 0.05, ** = 0.01, 0.001 = ***)."
#| 
corrplot(ellin_topocor,method = "ellipse",
         tl.pos = "dt",tl.col = "black",sig.level = c(0.001,0.01,0.05),
         p.mat = pval_ellin, insig = c("label_sig"), pch= "*",pch.cex = 1.0, pch.col ="black"
         ,tl.cex = 1.0, number.cex = 0.9,addgrid.col = "#f5f5f5")
```

Entonces si se toma a los indices de hellinberg como medidas indirectas de las condiciones de habitat y vemos como estás se relacionan con las variables topográficas y topologias, podriamos determinar dos grupos de variables, de las cuales uno se conforma por la luz ,temperatura y continentalidad mientras el otro se conforma por la humedad, reactividad y nutrientes, de modo que si un grupo se relaciona positivamente con una de las variables topológicas y topográficas positiva o negativamente, el otro podría relacionarse de manera contraria o no relacionarse. Caso en los que una variable se relaciona con uno de estos dos grupos pero no con el otro estaría la inclinación de la pendiente de las parcelas y el pH de las muestras de suelo, pues la inclinación de la pendiente se relaciona negativamente con la humedad, reactividad y nutrientes, pero no mostraría ningún tipo de correlación con la luz, temperatura y continentalidad (@fig-fig8 **(F)** y @fig-fig7) . Por otro lado, el pH diluido de muestras de suelo también se relacionan significativamente con el mismo grupo de variables pero de manera positiva, y tampoco tienen un grado de correlación considerable con la luz, temperatura y continentalidad (@fig-fig8 **(E)** y @fig-fig7).

```{r}
#| label: fig-fig8 
#| fig-cap: "Diagrama de dispersión de las variables topográficas y topolagicas contra los indices de Hellinberg.A) Relación entre continentalidad, temperatura y luz con la orientación sur-sureste. B) Relación entre humedad, reactividad y nutrientes con la orientación sur-sureste, C)Relación entre continentalidad, temperatura y luz con la capacidad calorifica sur-sureste. D)Relación entre humedad, reactividad y nutrientes con la capacidad calorifica sur-sureste, E)Relación entre humedad, reactividad y nutrientes con el pH diluido de las muestras de suelo. F)Relación entre humedad, reactividad y nutrientes con la pendiente de la parcela."

include_graphics("C:\\Users\\Asus\\Desktop\\Analisis multivariado\\Informe-final-de-multivariada\\Graficos\\Excel\\Ellenberg vs ambientales.svg")
```

El tipo de relieve también tiene una influencia significativa sobre la humedad, reactividad y nutrientes, aunque las correlaciones solo son considerables para la humedad y nutrientes, esta relación queda mejor evidenciada en la @fig-fig9(A-B), donde se observa una clara tendencia en la que los valores de humedad y nutrientes se distribuyen en valores más altos, seguidos por el relive neutro, y el relieve convexo que mantiene una distribución en valores más bajos. También se observa que los suelos con condiciones de fluvisoles tendian a tener datos concentrados en valores de humedad más altos que los que no tenian condiciones de fluvisoles. @fig-fig9(C).

```{r}
#| label: fig-fig9 
#| fig-cap: "Diagrama de cajas y bigotes para comparar los indices de Hellinberg en distintas condiciones topográficas.A)Comparación del indice de humedad entre distintos tipos de superficie.B)Comparación del indice de nutrientes entre distintos tipos de superficie.C)Comparación del indice de humedad entre suelos líticos y no líticos."

include_graphics("C:\\Users\\Asus\\Desktop\\Analisis multivariado\\Informe-final-de-multivariada\\Graficos\\Excel\\Boxplot_ Ellenberg vs ambientales.svg")

```
